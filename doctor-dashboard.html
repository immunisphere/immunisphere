<!DOCTYPE html>
<html>
<head>
  <title>Doctor Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>
<body>
  <h2>Doctor Dashboard</h2>
  <button id="logoutBtn">Logout</button>
  <div id="status">Checking login...</div>
  <div id="patientList"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAnhR2-KIlypbb4hriWuqFRC3SRk9Zmi2Q",
  authDomain: "immunisphere-f6239.firebaseapp.com",
  projectId: "immunisphere-f6239",
  storageBucket: "immunisphere-f6239.firebasestorage.app",
  messagingSenderId: "141342230101",
  appId: "1:141342230101:web:f9ba568327657e643536dc"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const statusDiv = document.getElementById("status");
const patientList = document.getElementById("patientList");

// ðŸ” WAIT for auth to fully initialize
onAuthStateChanged(auth, async (user) => {
  console.log("Auth state:", user);

  if (user) {
    statusDiv.innerText = "Logged in as Doctor";
    loadPatients();
  } else {
    statusDiv.innerText = "Not logged in. Redirecting...";
    setTimeout(() => {
      window.location.href = "doctor-login.html";
    }, 1500);
  }
});

// ðŸšª Logout
document.getElementById("logoutBtn").onclick = () => {
  signOut(auth).then(() => {
    window.location.href = "doctor-login.html";
  });
};

// ðŸ‘¥ Load Patients
async function loadPatients() {
  patientList.innerHTML = "Loading patients...";
  const querySnapshot = await getDocs(collection(db, "users"));

  patientList.innerHTML = "";
  querySnapshot.forEach(doc => {
    const data = doc.data();
    if (data.role === "patient") {
      const div = document.createElement("div");
      div.innerHTML = `<p>${data.name} (${data.email})</p>`;
      patientList.appendChild(div);
    }
  });
}
</script>
</body>
</html>

