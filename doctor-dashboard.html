<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Doctor Dashboard</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f7fb;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #2a4d69;
    }
    .case-list {
      max-width: 1000px;
      margin: 20px auto;
    }
    .case-card {
      background: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      box-shadow: 0 0 10px rgba(0,0,0,0.08);
    }
    .case-card h3 {
      margin: 0 0 8px 0;
      color: #1e3d59;
    }
    .case-card p {
      margin: 4px 0;
      font-size: 14px;
    }
    .status {
      font-weight: bold;
      color: green;
    }
    button {
      margin-top: 8px;
      padding: 6px 10px;
      border: none;
      background: #2a4d69;
      color: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
  </style>
</head>
<body>

<h1>Doctor Dashboard</h1>
<div class="case-list" id="caseList">
  Loading cases...
</div>

<!-- ðŸ”¥ Firebase + Dashboard Logic -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAnhR2-KIlypbb4hriWuqFRC3SRk9Zmi2Q",
    authDomain: "immunisphere-f6239.firebaseapp.com",
    projectId: "immunisphere-f6239",
    storageBucket: "immunisphere-f6239.firebasestorage.app",
    messagingSenderId: "141342230101",
    appId: "1:141342230101:web:f9ba568327657e643536dc",
    databaseURL: "https://immunisphere-f6239-default-rtdb.firebaseio.com"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const caseListDiv = document.getElementById("caseList");

  const casesRef = ref(database, "cases/");

  onValue(casesRef, (snapshot) => {
    caseListDiv.innerHTML = "";
    const cases = snapshot.val();

    if (!cases) {
      caseListDiv.innerHTML = "No cases found.";
      return;
    }

    Object.values(cases).forEach(caseItem => {
      if (caseItem.status && caseItem.status.includes("Paid")) {

        const card = document.createElement("div");
        card.className = "case-card";

        card.innerHTML = `
          <h3>${caseItem.name} (Age: ${caseItem.age})</h3>
          <p><strong>Case ID:</strong> ${caseItem.caseId}</p>
          <p><strong>Phone:</strong> ${caseItem.phone}</p>
          <p><strong>Main Complaint:</strong> ${caseItem.main_complaint || "N/A"}</p>
          <p><strong>Duration:</strong> ${caseItem.duration || "N/A"}</p>
          <p class="status">Status: ${caseItem.status}</p>
          <button onclick="markReviewed('${caseItem.caseId}')">Mark as Reviewed</button>
        `;

        caseListDiv.appendChild(card);
      }
    });
  });

  window.markReviewed = function(caseId) {
    update(ref(database, 'cases/' + caseId), {
      status: "Reviewed by Doctor"
    });
    alert("Case marked as reviewed");
  };
</script>

</body>
</html>
