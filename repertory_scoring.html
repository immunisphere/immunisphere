<script>
// Rubrics extracted from AI case (can later be dynamic)
const rubrics = JSON.parse(localStorage.getItem("aiRubrics")) || [
"Head pain – throbbing",
"Worse motion",
"Better rest",
"Thirstless",
"Emotional sensitivity"
];

document.getElementById("rubricList").innerHTML =
    rubrics.map(r => "• " + r).join("<br>");

// Expanded demo repertory database
const repertoryDB = {
"Bryonia": ["Worse motion","Better rest","Dryness","Irritable","Head pain"],
"Pulsatilla": ["Thirstless","Emotional","Better company","Weepy","Changeable symptoms"],
"Belladonna": ["Throbbing pain","Heat","Sudden onset","Red face"],
"Nat Mur": ["Reserved","Grief","Headache like hammer","Craves salt","Emotional"]
};

// Score calculation
let scores = {};
let totalRubricMatches = 0;

rubrics.forEach(rubric => {
    for (let remedy in repertoryDB) {
        if (repertoryDB[remedy].some(symptom =>
            rubric.toLowerCase().includes(symptom.toLowerCase())
        )) {
            scores[remedy] = (scores[remedy] || 0) + 1;
            totalRubricMatches++;
        }
    }
});

// Convert scores to probability %
let remedyResults = Object.entries(scores).map(([remedy, score]) => {
    return {
        name: remedy,
        score: score,
        probability: ((score / totalRubricMatches) * 100).toFixed(1)
    };
});

// Sort highest probability first
remedyResults.sort((a, b) => b.probability - a.probability);

// Display results with visual bar
const resultsDiv = document.getElementById("results");

remedyResults.forEach(r => {
    resultsDiv.innerHTML += `
        <div class="remedy">
            <strong>${r.name}</strong>
            <span class="score">${r.probability}%</span>
            <div style="background:#eee; border-radius:4px; margin-top:5px;">
                <div style="
                    width:${r.probability}%;
                    background:#2bb673;
                    height:8px;
                    border-radius:4px;">
                </div>
            </div>
        </div>
    `;
});
</script>
